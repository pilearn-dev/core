{% set needs_mathjax=True %}
{% extends "layout.html" %}
{% block body %}
  <nav class="coursenav">
    {% set topic = course.getTopic() %}
    <h2>{{ course.getTitle() }} <i><a href="/topic/{{ topic.id }}/{{ topic.getName() }}/info" class="topic">{{ topic.getTitle() }}</a></i></h2>
    {{ course.getByLine()|markdown }}
    <ul>
      <li><a href="/course/{{ course.id }}/{{ course.getLabel() }}/details">Informationen</a></li>
      <li class="active"><a href="#!">Kursinhalte</a></li>
      <li><a href="/forum/{{ course.id }}/{{ course.getLabel() }}/list">Kursforum</a></li>
    </ul>
  </nav>
 <div class="split-screen">
   <aside>
     <h3>Alle Inhalte</h3>
     <ol>
       {% for element in course.getMenu() %}
        {% if element.availible %}
        {% if element.id == data.id %}
        <li><a href="/c/{{ course.id }}/u/{{ element.id }}" class="current">{{ element.title }}</a>
        {% else %}
        <li><a href="/c/{{ course.id }}/u/{{ element.id }}">{{ element.title }}</a>
        {% endif %}
        {% elif user.isMod() or course.getCourseRole(user) >=3 %}
        <li class="current visited"><a style="opacity: 0.4" href="/c/{{ course.id }}/u/{{ element.id }}">{{ element.title }}</a>
        {% endif %}
          {% if element.children %}
          <ol>
            {% for child in element.children %}
             {% if child.availible %}
             {% if child.id == data.id %}
             <li><a href="/c/{{ course.id }}/u/{{ child.id }}" class="current">{{ child.title }}</a>
             {% else %}
             <li><a href="/c/{{ course.id }}/u/{{ child.id }}">{{ child.title }}</a>
             {% endif %}
             {% elif user.isMod() or course.getCourseRole(user) >=3 %}
             <li><a style="opacity: 0.4" href="/c/{{ course.id }}/u/{{ child.id }}">{{ child.title }}</a>
             {% endif %}
            {% endfor %}
          </ol>
          {% endif %}
        </li>
       {% endfor %}
       {% if course.getCourseRole(user) >=3 %}
       <a href="#!" onclick="document.getElementById('unit-type-dialog-parent').value=0;document.getElementById('unit-type-dialog').classList.add('open')">Neue Seite</a>|<a href="/c/{{ course.id }}/unit_reorder">Neu anordnen</a>
       {% endif %}
     </ol>
   </aside>
   <main>
     {% if user.isMod() or course.getCourseRole(user) >= 3 %}
     <p style="margin: 0; font-size: 0.8em;"><strong>{{ data.getTitle() }}</strong> &ndash; {% if data.isDisabled() %}<span style="color: #d00;">Unveröffentlichte Seite</span>{% else %}Öffentliche Seite{% endif %} &ndash; <a href="/c/{{ course.id }}/u/{{ data.id }}/edit"><i class="fa fa-pencil"></i> Bearbeiten</a>{% if data.getDetail("parent") == 0 and course.getCourseRole(user) >= 3 %} &ndash; <a href="#!" onclick="document.getElementById('unit-type-dialog-parent').value={{ data.id }};document.getElementById('unit-type-dialog').classList.add('open')">Neue Unterseite</a>{% endif %}</p>
     <hr>
     {% endif %}
     {% if data.isDisabled() %}<div class="deleted-section" style="padding: 10px;">{% endif %}
     {% for i in data.getJSON() %}
      {% if i.type == "heading" %}
        <h1>{{ i.data.text }}</h1>
      {% elif i.type == "subheading" %}
        <h2>{{ i.data.text }}</h2>
      {% elif i.type == "subsubheading" %}
        <h3>{{ i.data.text }}</h3>
      {% elif i.type == "text" %}
        {{ (i.data.text.replace("\n", "\0")|striptags).replace("\0", "\n")|markdown }}
      {% elif i.type == "separator" %}
        <hr>
      {% elif i.type == "warnbox" %}
        <div class="warning">{{ (i.data.text.replace("\n", "\0")|striptags).replace("\0", "\n")|markdown }}</div>
      {% elif i.type == "quote" %}
        <blockquote>{{ (i.data.text.replace("\n", "\0")|striptags).replace("\0", "\n")|markdown }}</blockquote>
      {% elif i.type == "image" %}
        <a href="{{ i.data.source }}"><img src="{{ i.data.source }}"></a>
      {% elif i.type == "wiki-image" %}
        <div class="pull-to-right">
          <a href="{{ i.data.source }}"><img src="{{ i.data.source }}"></a>
        </div>
      {% endif %}
     {% endfor %}
     {% if data.isDisabled() %}</div>{% endif %}
   </main>
   {% if course.getCourseRole(user) >= 3 %}
   {% include "courses/_create_unit.html" %}
   {% endif %}
 </div>
{% endblock %}
